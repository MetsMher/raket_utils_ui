# GitFlow: Правила веток и защиты

Ниже описана структура веток и правила доступа для проекта, использующего GitFlow в GitLab.

---

## Основные ветки и защита

| Ветка            | Назначение                                  | Push доступ         | Merge доступ        | Только через MR? | CI обязателен? | Автоудаление после MR |
|------------------|---------------------------------------------|----------------------|----------------------|------------------|----------------|---------------------|
| `main`           | Продакшен-код                               | **Нет (NO_ACCESS)** | **DEVELOPER**         | **Да**           | Да             | Да                  |
| `develop`        | Интеграция всех фич                         | **Нет (NO_ACCESS)** | **DEVELOPER**         | **Да**           | Да             | Да                  |
| `release/*`      | Подготовка релиза                           | **Нет (NO_ACCESS)** | **DEVELOPER**         | **Да**           | Да             | Да                  |
| `hotfix/*`       | Экстренные правки для `main`                | **Нет (NO_ACCESS)** | **MAINTAINER**        | **Да**           | Да             | Да                  |
| `feature/*`      | Разработка фич                              | **DEVELOPER**       | **DEVELOPER**         | **Нет**          | Опционально    | Да (еслиMR)         |

---

## Дополнительные правила и рекомендации

| Возможность                          | Где применимо       | Как включить                                                                |
|-------------------------------------|----------------------|-----------------------------------------------------------------------------|
| Только Merge Request → `main`       | `main`, `develop`    | `push_access_level = NO_ACCESS`                                             |
| Защита от force-push                | Везде                | GitLab защищает по умолчанию при `protected`                                |
| Обязательный pipeline               | `main`, `develop`    | В настройках проекта: "Pipelines must succeed" перед merge                  |
| Требование ревью/аппрувов           | `main`, `develop`    | Settings → General → Merge Request approvals                                |
| MR шаблоны (description)            | Везде                | Файл `.gitlab/merge_request_templates/*.md`                                 |
| Автоматическое удаление ветки       | Везде                | В MR настройках: `remove_source_branch: True`                               |
| Code Owners                         | `main`, `develop`    | Через `CODEOWNERS` файл + `code_owner_approval_required: True`              |

---

## Рекомендации

- Никогда не пушить напрямую в `main` и `develop`
- Всегда создавать MR из `feature/*` → `develop`
- Использовать `release/*` для подготовки продакшн-релизов
- Поддерживать чистую и понятную историю с помощью squash-мержа
- Автоматизировать всё, что можно, через `.gitlab-ci.yml` и GitLab Rules

---